{% extends 'layout.twig' %}

{% block head %}
<title>Homepage</title>
{% endblock %}

{%  block content %}
<nav class="navbar navbar-light bg-faded navbar-static-top hidden-md-down" id="options-navbar" style="padding: 0; height: 47px; border-bottom: 1px solid #dce0e0;">
  <div class="container-fluid" style="height: 100%;">
    <ul class="nav navbar-nav">
      <li class="nav-item hidden-md-down" style="height: 100%;">
        <div class="form-group input-group" style="height: 100%; width: 220px;">
          <span class="input-group-addon panel-input-symbol" style="border-bottom: 0; padding: 0; padding-right: 0; background-color: #FAFAFA;"><i class="fa fa-globe" aria-hidden="true"></i></span>
          <input type="text" title="Location" class="form-control" id="pac-input" style="height: 100%; width: 210px; border: 0; background-color: #FAFAFA;" placeholder="Location" latitude="" longitude="">
        </div>
      </li>
      <li class="nav-item hidden-md-down" style="height: 46px;">
        <button id="radius-popover"type="button" class="btn btn-option square-border" data-container="body" data-toggle="popover" data-placement="bottom">Radius <i class="fa fa-caret-down" aria-hidden="true"></i></button>
        <div id="radius-popover-title" class="hidden-xs-up"></div>
        <div id="radius-popover-content" class="hidden-xs-up">
          <div class="form-group">
            <label for="radiusMinInput">Radius</label>
            <input type="number" class="form-control" id="radiusInput" placeholder="Radius">
          </div>
          <button id="radiusApply" class="btn btn-option square-border" style="background-color: #E8E9EC; border: 1px solid #dce0e0">Apply</button>
        </div>
      </li>
      <li class="nav-item hidden-md-down" style="height: 46px; margin-left: -6px;">
        <button id="quantity-popover"type="button" class="btn btn-option square-border" data-container="body" data-toggle="popover" data-placement="bottom">Quantity <i class="fa fa-caret-down" aria-hidden="true"></i></button>
        <div id="quantity-popover-title" class="hidden-xs-up"></div>
        <div id="quantity-popover-content" class="hidden-xs-up">
          <div class="form-group">
            <label for="quantityMinInput">Min Quantity</label>
            <input type="number" class="form-control" id="quantityMinInput" placeholder="Min">
          </div>
          <div class="form-group">
            <label for="quantityMaxInput">Max Quantity</label>
            <input type="number" class="form-control" id="quantityMaxInput" placeholder="Max">
          </div>
          <button id="QuantityApply" class="btn btn-option square-border" style="background-color: #E8E9EC; border: 1px solid #dce0e0">Apply</button>
        </div>
      </li>
      <li class="nav-item hidden-md-down" style="height: 46px; margin-left: -6px;">
        <button id="weight-popover"type="button" class="btn btn-option square-border" style="border-right: 1px solid #dce0e0" data-container="body" data-toggle="popover" data-placement="bottom">Weight <i class="fa fa-caret-down" aria-hidden="true"></i></button>
        <div id="weight-popover-title" class="hidden-xs-up"></div>
        <div id="weight-popover-content" class="hidden-xs-up">
          <div class="form-group">
            <label for="weightMinInput">Min Weight</label>
            <input type="number" class="form-control" id="weightMinInput" placeholder="Min">
          </div>
          <div class="form-group">
            <label for="weightMaxInput">Max Weight</label>
            <input type="number" class="form-control" id="weightMaxInput" placeholder="Max">
          </div>
          <button id="WeightApply" class="btn btn-option square-border" style="background-color: #E8E9EC; border: 1px solid #dce0e0">Apply</button>
        </div>
      </li>
    </ul>

    <ul class="nav navbar-nav float-xs-right">
      <li class="nav-item" style="height: 46px; margin-left: -6px;">
        <button class="btn btn-option square-border fake-button-new" style="">Sort By:</button>
      </li>
      <li class="nav-item" style="height: 46px; margin-left: -6px;">
        <button id="radius-sort" class="btn btn-option square-border" style="">Radius <i id="radius-sort-icon" class="fa fa-sort-asc" aria-hidden="true"></i></button>
      </li>
      <li class="nav-item" style="height: 46px; margin-left: -6px;">
        <button id="quantity-sort" class="btn btn-option square-border" style="">Quantity <i id="quantity-sort-icon" class="" aria-hidden="true"></i></button>
      </li>
      <li class="nav-item" style="height: 46px; margin-left: -6px;">
        <button id="weight-sort" class="btn btn-option square-border" style="">Weight <i id="weight-sort-icon" class="" aria-hidden="true"></i></button>
      </li>
    </ul>
  </div>
</nav>

<nav class="navbar navbar-light bg-faded navbar-static-top hidden-lg-up" id="options-navbar" style="padding: 0; height: 47px; border-bottom: 1px solid #dce0e0;">
  <div class="container-fluid" style="height: 100%;">
    <ul class="nav navbar-nav">
      <li class="nav-item" style="width: 33.333%; height: 46px; margin-left: -6px;">
        <button class="btn btn-option square-border" style="border-left: 0; width: 100%;" type="button" data-toggle="collapse" data-target="#collapseSearch" aria-expanded="false" aria-controls="collapseExample">Search</button>
      </li>
      <li class="nav-item" style="width: 33.333%; height: 46px; margin-left: -6px;">
        <button class="btn btn-option square-border" style="width: 100%;" type="button" data-toggle="collapse" data-target="#collapseFilter" aria-expanded="false" aria-controls="collapseExample">Filter</button>
      </li>
      <li class="nav-item" style="width: 33.333%; height: 46px; margin-left: -6px;">
        <button class="btn btn-option square-border" style="width: 100%;" type="button" data-toggle="collapse" data-target="#collapseSort" aria-expanded="false" aria-controls="collapseExample">Sort</button>
      </li>
    </ul>
  </div>
</nav>
<div class="collapse" id="collapseFilter">
  <!-- FILTER OPTIONS -->
  <div class="card card-block">
    <form class="form-group" id="options">
      <h5>Category</h5>
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle index square-border" style="margin-right: -17px;" type="button" id="categories-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Categories
        </button>
        <div class="dropdown-menu" id="topic-dropdown" aria-labelledby="categories-dropdown">
          <a class="dropdown-item" href="#">Fresh Food</a>
          <a class="dropdown-item" href="#">Bakery</a>
          <a class="dropdown-item" href="#">Food Cupboard</a>
          <a class="dropdown-item" href="#">Frozen Food</a>
          <a class="dropdown-item" href="#">Drinks</a>
          <a class="dropdown-item" href="#">Baby</a>
          <a class="dropdown-item" href="#">Personal</a>
          <a class="dropdown-item" href="#">Pet Care</a>
          <a class="dropdown-item" href="#">Household</a>
        </div>
      </div>

      <br>

      <h5>Location</h5>
      <label class="sr-only" for="locationInputGroup">Location</label>
      <div class="input-group mb-0 mr-sm-2 mb-sm-0" style="margin-right: -6px;">
        <div class="input-group-addon square-border"><i class="fa fa-search" aria-hidden="true"></i></div>
        <input type="text" title="Location" class="form-control square-border" id="pac-input" placeholder="Location">
      </div>

      <br>

      <h5>Amount</h5>
      <label class="sr-only" for="amountInputGroup">Amount</label>
      <div class="input-group mb-0 mr-sm-2 mb-sm-0" style="margin-right: -6px;">
        <div class="input-group-addon square-border"><i class="fa fa-hashtag" aria-hidden="true"></i></div>
        <input type="number" title="Quantity" class="form-control square-border" placeholder="Min" style="width: 4rem; margin-right: -1px;" onkeypress='return event.charCode >= 48 && event.charCode <= 57'>
        <input type="number" title="Quantity" class="form-control square-border" placeholder="Max" style="width: 4rem;" onkeypress='return event.charCode >= 48 && event.charCode <= 57'>
      </div>

      <br>

      <h5>Weight</h5>
      <label class="sr-only" for="weightInputGroup">Weight</label>
      <div class="input-group mb-0 mr-sm-2 mb-sm-0" style="margin-right: -6px;">
        <div class="input-group-addon square-border"><i class="fa fa-balance-scale" aria-hidden="true"></i></div>
        <input type="number" title="Weight" class="form-control square-border" placeholder="Min" style="width: 4rem; margin-right: -1px;" onkeypress='return event.charCode >= 48 && event.charCode <= 57'>
        <input type="number" title="Weight" class="form-control square-border" placeholder="Max" style="width: 4rem;" onkeypress='return event.charCode >= 48 && event.charCode <= 57'>
      </div>

      <br>

      <button type="button" class="btn square-border">Refresh</button>

    </form>
  </div>
</div>
<div class="collapse" id="collapseSort">
  <!-- SORT OPTIONS -->
  <div class="card card-block">
    <div class="btn-group mr-1" role="group" aria-label="First group" style="margin: 0 !important;">
      <div class="container">
        <div class="row">
          <div class="col-xs-4">
            <button id="radius-sort" type="button" class="btn btn-secondary square-border"><i id="radius-sort-icon" class="fa fa-sort-asc" aria-hidden="true"></i> Radius</button>
          </div>
          <div class="col-xs-4">
            <button id="weight-sort" type="button" class="btn btn-secondary square-border"><i id="weight-sort-icon" class="" aria-hidden="true"></i>  Weight</button>
          </div>
          <div class="col-xs-4">
            <button id="expiry-sort" type="button" class="btn btn-secondary square-border"><i id="expiry-sort-icon" class="" aria-hidden="true"></i> Expiry</button>
          </div>
        </div>
      </div>
      <br>
      <button id="radius-sort" type="button" class="btn btn-secondary square-border" style="width:33%;"><i id="radius-sort-icon" class="fa fa-sort-asc" aria-hidden="true"></i> Radius</button>
      <button id="weight-sort" type="button" class="btn btn-secondary" style="width:33%;"><i id="weight-sort-icon" class="" aria-hidden="true"></i>  Weight</button>
      <button id="expiry-sort" type="button" class="btn btn-secondary square-border" style="width:33%;"><i id="expiry-sort-icon" class="" aria-hidden="true"></i> Expiry</button>
    </div>
  </div>
</div>

<div class="container-fluid" style="height: 14px;"></div>

<div class="container-fluid main" style="margin-left: 10px; margin-right: 10px;">
  <div class="row">
    <!-- FOOD ITEMS -->
    <!--<div class="col-md-6 items" style="overflow: scroll; height: 818px; overflow-x:hidden;">-->
    <div class="col-md-7 no-padding" style="overflow: scroll; overflow-x:hidden;" id="items">
      <div class="container" style="padding: 0;">
        <div class="card-columns" id="item-cards" style="column-gap: 0.4rem;">
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="border: 1px solid #dce0e0">
            <div class="row">
              <div class="col-xs-5" style="padding-right:0">
                <img class="card-img-top" src="res/oranges.jpg" alt="Card image cap" style="width:100%;">
              </div>
              <div class="col-xs-7">
                <div class="card-block" style="padding: 0.5rem; padding-top: 1rem; padding-bottom: 0;">
                  <h5 class="card-title">Oranges</h5>
                  <p style="font-size:1em; margin-bottom:5px">Some lovely and tasty oranges for all to enjoy ♥</p>
                  <table class="table table-sm">
                    <tbody style="font-size: 1em">
                      <tr>
                        <td scope="row" style="padding-left: 0;">Expiry Date:</th>
                        <td>21/03/2017</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Amount:</th>
                        <td>5</td>
                      </tr>
                      <tr>
                        <td scope="row"  style="padding-left: 0;">Weight:</th>
                        <td>500g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

        </div>

        <i class="fa fa-spinner fa-pulse fa-3x fa-fw hidden-xs-up" id="loading-icon"></i>
      </div>
    </div>
    <!-- MAP -->
    <div class="col-md-5 no-padding">
      <div id="map" style="width: 600; height: 900px;"></div>
    </div>

  </div>
</div>

<br>

{% endblock %}


{% block scripts %}
<!-- SEARCH FUNCTIONALITY -->
<script>
  var resultsSoFar = 0;
  var results;
  $(document).ready(refreshSearch());
</script>

<script>
  $(function($) {
    $('#items').on('scroll', function() {
      if($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
        addMoreItems();
      }
    })
  });
</script>

<script>
  // Sub-Search Applys
  // Location is with google api

  $("#radiusApply").click(function() {
    // Replace state instead of push state?
    history.pushState('Radius updated', 'Radius updated', document.location.href + "&radius=" + $("#radiusInput").val());
    refreshSearch();
  });

  $("#quantityApply").click(function() {
    // Replace state instead of push state?
    history.pushState('Quantity updated', 'Quantity updated', document.location.href + "&minQuantity=" + $("#minQuantityInput").val() + "&maxQuantity=" + $("#maxQuantityInput").val());
    refreshSearch();
  });

  $("#weightApply").click(function() {
    // Replace state instead of push state?
    history.pushState('Weight updated', 'Weight updated', document.location.href + "&minWeight=" + $("#minWeightInput").val() + "&maxWeight=" + $("#maxWeightInput").val());
    refreshSearch();
  });
</script>


<!-- CORRECT SIZES OF ELEMENTS -->
<script>
  $(document).ready(function() {
    $('#main-search-input').width($('#search-navbar-container').width() - $('a.navbar-brand').outerWidth() - $('#categories-dropdown').outerWidth() - $('#register-button').outerWidth() - $('#login-button').outerWidth() - 150);
    $('#search-navbar-group').width($('#search-navbar-container').width() - $('a.navbar-brand').outerWidth() - $('#categories-dropdown').outerWidth() - $('#register-button').outerWidth() - $('#login-button').outerWidth() - 150);
    $('#items').height($(window).height() - $('#search-navbar').height() - $('#options-navbar').height() - 14);
    $('#map').height($(window).height() - $('#search-navbar').height() - $('#options-navbar').height() - 14);
  });
  /* Vertically Centre Modal - From Stack Overflow */
  $(function() {
    function reposition() {
      var modal = $(this), dialog = modal.find('.modal-dialog');
      modal.css('display', 'block');
      // Dividing by two centers the modal exactly, but dividing by three
      // or four works better for larger screens.
      dialog.css("margin-top", Math.max(0, ($(window).height() - dialog.height()) / 2));
    }
    // Reposition when a modal is shown
    $('.modal').on('show.bs.modal', reposition);
    // Reposition when the window is resized
    $(window).on('resize', function() {
      $('.modal:visible').each(reposition);
    });
  });
  function resize() {
    $('#main-search-input').width($('#search-navbar-container').width() - $('a.navbar-brand').outerWidth() - $('#categories-dropdown').outerWidth() - $('#register-button').outerWidth() - $('#login-button').outerWidth() - 150);
    $('#search-navbar-group').width($('#search-navbar-container').width() - $('a.navbar-brand').outerWidth() - $('#categories-dropdown').outerWidth() - $('#register-button').outerWidth() - $('#login-button').outerWidth() - 150);
    $('#items').height($(window).height() - $('#search-navbar').height() - $('#options-navbar').height() - 14);
    $('#map').height($(window).height() - $('#search-navbar').height() - $('#options-navbar').height() - 14);
  }
</script>

<script>
// Popovers
$('#radius-popover').popover({
  html : true,
  title: function() {
    return $("#radius-popover-head").html();
  },
  content: function() {
    return $("#radius-popover-content").html();
  }
});
$('#quantity-popover').popover({
  html : true,
  title: function() {
    return $("#quantity-popover-head").html();
  },
  content: function() {
    return $("#quantity-popover-content").html();
  }
});
$('#weight-popover').popover({
  html : true,
  title: function() {
    return $("#weight-popover-head").html();
  },
  content: function() {
    return $("#weight-popover-content").html();
  }
});
</script>

<!-- HANDLE SORTING -->
<script>
  //  Radius
  $("#radius-sort").click(function() {
    // Change Icon
    if ($("#radius-sort-icon").hasClass("fa-sort-asc")) {
      $("#radius-sort-icon").attr('class', 'fa fa-sort-desc'); // Set to Descending
      // Sort Items
    } else if ($("#radius-sort").hasClass("fa-sort-desc")) {
      $("#radius-sort-icon").attr('class', 'fa fa-sort-asc'); // Set to Ascending
      // Sort Items
    } else {
      $("#radius-sort-icon").attr('class', 'fa fa-sort-asc'); // Set to Ascending
      // Sort Items
    }
    $("#weight-sort-icon").attr('class', '');
    $("#quantity-sort-icon").attr('class', '');
  });

  // Weight
  $("#weight-sort").click(function() {
    // Change Icon
    if ($("#weight-sort-icon").hasClass("fa-sort-asc")) {
      $("#weight-sort-icon").attr('class', 'fa fa-sort-desc'); // Set to Descending
      // Sort Items
    } else if ($("#weight-sort").hasClass("fa-sort-desc")) {
      $("#weight-sort-icon").attr('class', 'fa fa-sort-asc'); // Set to Ascending
      // Sort Items
    } else {
      $("#weight-sort-icon").attr('class', 'fa fa-sort-asc'); // Set to Ascending
      // Sort Items
    }
    $("#radius-sort-icon").attr('class', '');
    $("#quantity-sort-icon").attr('class', '');
  });

  // Expiry
  $("#quantity-sort").click(function() {
    // Change Icon
    if ($("#quantity-sort-icon").hasClass("fa-sort-asc")) {
      $("#quantity-sort-icon").attr('class', 'fa fa-sort-desc'); // Set to Descending
      // Sort Items
    } else if ($("#quantity-sort").hasClass("fa-sort-desc")) {
      $("#quantity-sort-icon").attr('class', 'fa fa-sort-asc'); // Set to Ascending
      // Sort Items
    } else {
      $("#quantity-sort-icon").attr('class', 'fa fa-sort-asc'); // Set to Ascending
      // Sort Items
    }
    $("#radius-sort-icon").attr('class', '');
    $("#weight-sort-icon").attr('class', '');
  });
</script>

<script>
    /*var map = null;

    function initMapElements() {
      // 67.9222° N, 26.5046° E
      var durham = {lat: 54.7752493, lng: -1.584852};
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: durham,
        disableDefaultUI: true
      });

      var marker = new google.maps.Marker({
        position: durham,
        map: map
      });

    }*/
    var map = null;

    function initMapElements() {

      var durham = {lat: 54.7752493, lng: -1.584852};
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: durham
      });
      var marker = new google.maps.Marker({
        position: durham,
        map: map
      });

      // Create the search box and link it to the UI element.
      var input = document.getElementById('pac-input');
      var searchBox = new google.maps.places.SearchBox(input);

      // Listen for the event fired when the user selects a prediction and retrieve
      // more details for that place.
      searchBox.addListener('places_changed', function() {
        var places = searchBox.getPlaces();

        if (places.length == 0) {
          return;
        }

        // For each place, get the icon, name and location.
        var bounds = new google.maps.LatLngBounds();
        places.forEach(function(place) {
          if (!place.geometry) {
            console.log("Returned place contains no geometry");
            return;
          }

          /*var icon = {
            url: place.icon,
            size: new google.maps.Size(71, 71),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(17, 34),
            scaledSize: new google.maps.Size(25, 25)
          };

          console.log(icon);*/
          $("#pac-input").attr("latitude", place.geometry.location.lat());
          $("#pac-input").attr("longitude", place.geometry.location.lng());

          history.pushState('Location updated', 'Location updated', document.location.href + "&latitude=" + place.geometry.location.lat() + "&longitude" + place.geometry.location.lng());
          refreshSearch();

        });
      });
    }
  </script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxJox1KlfQI8Tzo1I4wAMgSUELoga4DX0&libraries=places&callback=initMapElements">
</script>

{% endblock %}
